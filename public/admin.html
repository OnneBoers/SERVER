<html>
	<head>
		<title>Admin console</title>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
		<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {

			    var socket = io.connect('http://localhost:3700/admin');

			    socket.on('console', function (data) {
			        $('.console').prepend("<pre>" + JSON.stringify(data) + "</pre>");
			    });

				socket.on('updateControlPanel', function (data) {
					var html = "";
					for(var game in data) {
						console.log(JSON.stringify(game));
						if(data[game].isPlaying) {
							html += "<div class='game active'>";
						} else {
							html += "<div class='game'>";
						}
						html +=	"	<p class='gameTitle'>Game title: " + game + "</p>";
						if(data[game].player1Alive) {
							html += "<p class='playerName active" + data[game].player1State + "'>Player 1: " + data[game].player1 + "</p>";
						} else {
							html += "<p class='playerName'>Player 1: " + data[game].player1 + "</p>";
						}
						if(data[game].player2Alive) {
							html += "<p class='playerName active" + data[game].player2State + "'>Player 2: " + data[game].player2 + "</p>";
						} else {
							html += "<p class='playerName'>Player 2: " + data[game].player2 + "</p>";
						}
						if(data[game].mayStart) {
							html += "<a href='#' class='startGame' data-game='" + data[game].title + "'>Start game</a>&nbsp;";
						}
						if(data[game].isPlaying) {
							html += "<a href='#' class='stopGame' data-game='" + data[game].title + "'>Stop game</a>";
						}
						html += "</div>";
						$('.control').html(html);
					}
				});

				$('.init').click(function() {
					socket.emit('initComPorts', {});
				});
				$('.current').click(function() {
					socket.emit('listActive', {});
				});
				$('.handshake').click(function() {
					socket.emit('getHandshake', {});
				});
				$('.startGame').click(function() {
					var game = $(this).data("game");
					socket.emit('startGame', {value: game});
				})
				$('.stopGame').click(function() {
					var game = $(this).data("game");
					socket.emit('stopGame', {value: game});
				})
			});
		</script>
		<style>
			.col-md-6 {
				height: 100%;
				position: relative;
			}

			.well {
				max-width: 100%;
				max-height: 100%;
				overflow-x: scroll;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<nav class="navbar navbar-default">
				<div class="container-fluid">
					<div id="navbar" class="navbar-collapse collapse">
						<ul class="nav navbar-nav">
							<li>
								<a class="init" href="#">Init comports</a>
							</li>
							<li>
								<a class="current" href="#">Get sPorts variable (debugging)</a>
							</li>
							<li>
								<a class="handshake" href="#">Get handshake</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
			<div class="row">
				<div class="col-md-12">
					<h1 class="page-header">Arduino games</h1>
				</div>
				<div class="col-md-5">
					<h2>Console</h2>
					<div class="console">

					</div>
				</div>
				<div class="col-md-7">
					<h2>Game control panel</h2>
					<div class="control">

					</div>
				</div>
			</div>
		</div>

	</body>
</html>
